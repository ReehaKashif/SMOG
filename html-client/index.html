<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<title>AQI Punjab Dashboard</title>
<!-- Tell the browser to be responsive to screen width -->
<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
<!-- Bootstrap 3.3.7 -->
<link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"/>
<!-- Font Awesome -->
<link href="bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet"/>
<!-- Theme style -->
<link href="dist/css/AdminLTE.css" rel="stylesheet"/>
<link href="dist/css/skins/_all-skins.css" rel="stylesheet"/>
<!-- Morris chart -->
<link href="bower_components/morris.js/morris.css" rel="stylesheet"/>
<!-- jvectormap -->
<link href="bower_components/jvectormap/jquery-jvectormap.css" rel="stylesheet"/>
<!-- Date Picker -->
<link href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" rel="stylesheet"/>
<!-- Daterange picker -->
<link href="bower_components/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet"/>
<!-- bootstrap wysihtml5 - text editor -->
<link href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet"/>
<link href="./dist/css/style.css" rel="stylesheet"/>
<!-- Leaflet Libs -->
<link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<!-- ShapeFile Lib -->
<script src="https://unpkg.com/shapefile@0.6.6/dist/shapefile.js"></script>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Google Font -->
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic" rel="stylesheet"/>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">
<header class="main-header">
<!-- Header Navbar: style can be found in header.less -->
<nav class="navbar navbar-static-top">
<!-- Logo -->
<a class="logo" href="#">
<!-- mini logo for sidebar mini 50x50 pixels -->
<span class="logo-mini"><b>A</b>LT</span>
<!-- logo for regular state and mobile devices -->
<img class="logo-image w-[100px] h-[80px] rounded-full" src="dist/img/logo.png"/>
<p class="uppercase">
              Punjab Information
              <br/>
              Technology Board
              <br/>
<span>GOVERNMENT OF THE PUNJAB</span>
</p>
</a>
<div class="navbar-custom-menu hidden">
<ul class="nav navbar-nav">
<!-- Notifications: style can be found in dropdown.less -->
<li class="dropdown notifications-menu">
<a class="dropdown-toggle" data-toggle="dropdown" href="#">
<i class="fa fa-bell-o"></i>
<span class="label label-warning">10</span>
</a>
<ul class="dropdown-menu">
<li class="header">You have 10 notifications</li>
<li>
<!-- inner menu: contains the actual data -->
<ul class="menu">
<li>
<a href="#">
<i class="fa fa-users text-aqua"></i> 5 new members
                          joined today
                        </a>
</li>
<li>
<a href="#">
<i class="fa fa-warning text-yellow"></i> Very long
                          description here that may not fit into the page and
                          may cause design problems
                        </a>
</li>
<li>
<a href="#">
<i class="fa fa-users text-red"></i> 5 new members
                          joined
                        </a>
</li>
<li>
<a href="#">
<i class="fa fa-shopping-cart text-green"></i> 25
                          sales made
                        </a>
</li>
<li>
<a href="#">
<i class="fa fa-user text-red"></i> You changed your
                          username
                        </a>
</li>
</ul>
</li>
<li class="footer"><a href="#">View all</a></li>
</ul>
</li>
<!-- Messages: style can be found in dropdown.less-->
<li class="dropdown messages-menu">
<a class="dropdown-toggle" data-toggle="dropdown" href="#">
<i class="fa fa-envelope-o"></i>
<span class="label label-success">4</span>
</a>
<ul class="dropdown-menu">
<li class="header">You have 4 messages</li>
<li>
<!-- inner menu: contains the actual data -->
<ul class="menu">
<li>
<!-- start message -->
<a href="#">
<div class="pull-left">
<img alt="User Image" class="img-circle" src="dist/img/user2-160x160.jpg"/>
</div>
<h4>
                            Support Team
                            <small><i class="fa fa-clock-o"></i> 5 mins</small>
</h4>
<p>Why not buy a new awesome theme?</p>
</a>
</li>
<!-- end message -->
<li>
<a href="#">
<div class="pull-left">
<img alt="User Image" class="img-circle" src="dist/img/user3-128x128.jpg"/>
</div>
<h4>
                            AdminLTE Design Team
                            <small><i class="fa fa-clock-o"></i> 2 hours</small>
</h4>
<p>Why not buy a new awesome theme?</p>
</a>
</li>
<li>
<a href="#">
<div class="pull-left">
<img alt="User Image" class="img-circle" src="dist/img/user4-128x128.jpg"/>
</div>
<h4>
                            Developers
                            <small><i class="fa fa-clock-o"></i> Today</small>
</h4>
<p>Why not buy a new awesome theme?</p>
</a>
</li>
<li>
<a href="#">
<div class="pull-left">
<img alt="User Image" class="img-circle" src="dist/img/user3-128x128.jpg"/>
</div>
<h4>
                            Sales Department
                            <small><i class="fa fa-clock-o"></i> Yesterday</small>
</h4>
<p>Why not buy a new awesome theme?</p>
</a>
</li>
<li>
<a href="#">
<div class="pull-left">
<img alt="User Image" class="img-circle" src="dist/img/user4-128x128.jpg"/>
</div>
<h4>
                            Reviewers
                            <small><i class="fa fa-clock-o"></i> 2 days</small>
</h4>
<p>Why not buy a new awesome theme?</p>
</a>
</li>
</ul>
</li>
<li class="footer"><a href="#">See All Messages</a></li>
</ul>
</li>
<!-- User Account: style can be found in dropdown.less -->
<li class="dropdown user user-menu">
<a class="dropdown-toggle admin" data-toggle="dropdown" href="#">
<img alt="User Image" class="user-image" src="dist/img/logo.svg"/>
<span class="hidden-xs">Admin PITB</span>
<i class="fa fa-angle-down"></i>
</a>
<ul class="dropdown-menu">
<!-- User image -->
<li class="user-header">
<img alt="User Image" class="img-circle bg-white" src="dist/img/logo.svg"/>
<p>
                      Admin - PITB
                      <small>Member since Nov. 2012</small>
</p>
</li>
<!-- Menu Body -->
<li class="user-body">
<div class="row">
<div class="col-xs-4 text-center">
<a href="#">Details</a>
</div>
<div class="col-xs-4 text-center">
<a href="#">Details</a>
</div>
<div class="col-xs-4 text-center">
<a href="#">Details</a>
</div>
</div>
<!-- /.row -->
</li>
<!-- Menu Footer-->
<li class="user-footer">
<div class="pull-left">
<a class="btn btn-default btn-flat" href="#">Profile</a>
</div>
<div class="pull-right">
<a class="btn btn-default btn-flat" href="#">Sign out</a>
</div>
</li>
</ul>
</li>
</ul>
</div>
</nav>
</header>
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
<!-- Content Header (Page header) -->
<section class="content-header heading-bg pt-8">
<div class="flex flex-col items-start lg:flex-row lg:items-end gap-8 justify-between relative">
<div>
<img alt="User Image" src="dist/img/banner-icon.svg"/>
<div class="flex items-center gap-4">
<p class="text-4xl lg:text-6xl font-bold">AQI in</p>
<p class="text-4xl lg:text-6xl font-bold">
<select class="w-fit bg-transparent border-2 border-red-500 z-[1000] cursor-pointer" id="header-district-selector"></select>
</p>
<p class="hidden text-4xl lg:text-6xl font-bold">Pakistan</p>
</div>
</div>
<div class="w-full lg:w-fit relative -bottom-[230px] lg:-bottom-[200px] lg:absolute lg:right-1/2 lg:translate-x-1/2 order-2 lg:order-1">
<div class="speedometer">
<!-- Numbers -->
<div class="numbers hidden">
<span class="top-1/2 -left-10 -translate-y-[75%]">0</span>
<span class="top-1/4 left-0 -translate-x-1/2 -translate-y-[75%]">50</span>
<span class="-top-[10px] left-[calc(50%/3)]">100</span>
<span class="-top-[40px] left-1/2 -translate-x-1/2">150</span>
<span class="-top-[10px] right-[80px] translate-x-1/2">200</span>
<span class="top-1/4 right-0 translate-x-1/2 -translate-y-[75%]">300</span>
<span class="top-1/2 -right-10 translate-x-1/2 -translate-y-[75%]">500</span>
</div>
<!-- Color Labels -->
<div class="labels hidden">
<span class="top-1/2 -left-10 -translate-y-[75%]">Good</span>
<span class="-top-[10px] left-[calc(50%/3)] translate-x-1/2">Moderate</span>
<span class="top-1/4 left-0 -translate-x-1/2 -translate-y-[75%]">Unhealthy for Sensitive Groups</span>
<span class="-top-[40px] left-1/2 -translate-x-1/2">Unhealthy</span>
<span class="-top-[10px] right-[80px] translate-x-1/2">Very Unhealthy</span>
<span class="top-1/4 right-0 translate-x-1/2 -translate-y-[75%]">Hazardous</span>
<span class="top-1/2 -right-10 translate-x-1/2 -translate-y-[75%]">Very Hazardous</span>
</div>
<!-- AQI METER -->
<div class="needle" id="aqi-average-meter-neddle" style="--score: 0">
<span class="aqi-average font-bold text-white text-3xl md:text-4xl pointer-events-none select-none" id="aqi-average-meter"></span>
</div>
</div>
<!-- <p
                id="aqi-average"
                class="hidden text-[80px] md:text-[100px] leading-[80px] md:leading-[100px] font-bold"
              >
                -
              </p> -->
</div>
<div class="order-1 lg:order-2">
<p class="text-xl md:text-3xl">Current Time</p>
<p class="text-4xl lg:text-6xl font-bold" id="current-hour"></p>
<p class="text-4xl lg:text-6xl font-bold" id="current-date"></p>
</div>
</div>
</section>
<div class="form-group text-center mt-4">
<label class="h4" for="date-picker">Select Date:</label>
<input class="form-control w-25 mx-auto" id="date-picker" type="date"/>
</div>

<div class="form-group text-center mt-4">
<label class="h4" for="date-picker">Select Date:</label>
<input class="form-control w-25 mx-auto" id="date-picker" type="date"/>
</div>
<!-- Main content -->
<div class="row">
<div class="h-full">
<div class="nav-tabs-custom legend-source-option">
<!-- Tabs within a box -->
<ul class="nav nav-tabs pull-right no-border mb20">
<li class="pull-left header">
<h3><span>Major Causes of Smog</span></h3>
</li>
</ul>
<div class="row mb20">
<section class="col-lg-12 cause-section">
<select class="form-control" id="pollutant-source-selector">
<option value="All">All</option>
<option value="Vehicle">Vehicles</option>
<option value="Industry">Industry</option>
<option value="Construction">Construction</option>
<option value="Agriculture">Agriculture</option>
<option value="Miscellaneous">Miscellaneous</option>
</select>
</section>
<section class="col-lg-12" style="margin-top: 16px">
<p style="float: left; margin-right: 10px; line-height: 25px">
                      Sources:
                    </p>
<div class="industry-1 btn-flat flex items-center gap-4">
<img alt="User Image" class="user-image" src="dist/img/icon1.svg"/>
                      Vehicle
                    </div>
<div class="industry-2 btn-flat flex item">
<img alt="User Image" class="user-image" src="dist/img/icon2.svg"/>
                      Industry
                    </div>
<div class="industry-3 btn-flat flex item">
<img alt="User Image" class="user-image" src="dist/img/icon3.svg"/>
                      Construction
                    </div>
<div class="industry-4 btn-flat flex item" style="background-color: #36454f50; border-color: #36454f">
<img alt="User Image" class="user-image" src="dist/img/icon4.svg"/>
                      Agriculture
                    </div>
<div class="industry-5 btn-flat flex item">
<img alt="User Image" class="user-image" src="dist/img/icon5.svg"/>
                      Miscellaneous
                    </div>
</section>
</div>
<!-- Forecast Chart -->
<div>
<div class="w-full tab-content no-padding" id="forecastMap" style="height: 750px; position: relative">
<section class="color-legend-on-map hidden">
<p class="legend">Legend</p>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon1.svg"/>
                          Vehicle
                        </p>
<div style="height: 20px"></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon2.svg"/>
                          Industry
                        </p>
<div class="two" style="height: 20px"></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon3.svg"/>
                          Construction
                        </p>
<div class="three" style="height: 20px"></div>
</div>
<div class="legend-1">
<p class="flex items-center gap-4">
<img alt="User Image" class="user-image" src="dist/img/icon4.svg"/>
                          Agriculture
                        </p>
<div class="four" style="height: 20px"></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon5.svg"/>
                          Miscellaneous
                        </p>
<div class="five" style="height: 20px"></div>
</div>
</section>
</div>
</div>
</div>
</div>
<div class="h-full hidden">
<div class="nav-tabs-custom legend-colour-code">
<!-- Tabs within a box -->
<ul class="nav nav-tabs pull-right no-border mb20">
<li class="pull-left header">
<h3><span>Legend</span> colour code</h3>
</li>
</ul>
<div class="row mb20">
<section class="col-lg-12">
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon1.svg"/>
                        Vehicle
                      </p>
<div></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon2.svg"/>
                        Industry
                      </p>
<div class="two"></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon3.svg"/>
                        Construction
                      </p>
<div class="three"></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon4.svg"/>
                        Agriculture
                      </p>
<div class="four"></div>
</div>
<div class="legend-1">
<p class="flex">
<img alt="User Image" class="user-image" src="dist/img/icon5.svg"/>
                        Miscellaneous
                      </p>
<div class="five"></div>
</div>
</section>
</div>
</div>
<!-- /.nav-tabs-custom -->
</div>
</div>
<!-- /.row (main row) -->
<div class="row w-full h-full mx-auto">
<img alt="map" class="w-full h-full" src="dist/img/bar.jpg"/>
</div>
<!-- /.content -->
</div>
<!-- /.content-wrapper -->
<footer class="main-footer">
<strong>
          Copyright © 2024-2025 <a href="#">Powered By Punjab IT Board</a>
</strong>
</footer>
</div>
<!-- ./wrapper -->
<!-- jQuery 3 -->
<script src="bower_components/jquery/dist/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
      $.widget.bridge("uibutton", $.ui.button);
    </script>
<!-- Bootstrap 3.3.7 -->
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Morris.js charts -->
<script src="bower_components/raphael/raphael.min.js"></script>
<script src="bower_components/morris.js/morris.min.js"></script>
<!-- Sparkline -->
<script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- jQuery Knob Chart -->
<script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
<!-- daterangepicker -->
<script src="bower_components/moment/min/moment.min.js"></script>
<script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="dist/js/pages/dashboard.js"></script>
<!-- Chart.Js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="dist/js/demo.js"></script>
<!-- CUSTOM SCRIPTS START HERE -->
<!-- Custom Script to handle Shapes on Map -->
<script src="dist/js/lib/shapefile.js"></script>
<script src="dist/js/lib/pollutant-data.js"></script>
<script src="dist/js/lib/pollutant-calculations.js"></script>
<script src="dist/js/api/index.js"></script>
<script src="dist/js/api/chart.js"></script>
<script src="dist/js/api/district.js"></script>
<script src="dist/js/api/map.js"></script>
<script>
  // Function to fetch smog data based on selected date and district
  async function fetchSmogData(date, district) {
    // Format the date as MM/DD/YYYY
    const formattedDate = new Date(date).toLocaleDateString('en-US');
    try {
      const response = await fetch(`https://smog-server.onrender.com/api/october_sources?input_date=${encodeURIComponent(formattedDate)}&input_district=${encodeURIComponent(district)}`);
      if (!response.ok) throw new Error('Network response was not ok');
      const data = await response.json();
      return data;
    } catch (error) {
      console.error(`Failed to fetch data for ${district}:`, error);
      return null;
    }
  }

  // Event listener for date picker change
  document.getElementById('date-picker').addEventListener('change', function() {
    const selectedDate = this.value;
    if (selectedDate) {
      // Update popups for each district based on the selected date
      updateDistrictPopups(selectedDate);
    }
  });

  // Function to update popups with smog data
  async function updateDistrictPopups(date) {
    // Example districts - you should replace this with actual district data used in the map
    const districts = [
      'Lahore', 'Faisalabad', 'Rawalpindi', 'Multan', 'Gujranwala', 'Sialkot',
      'Sargodha', 'Bahawalpur', 'Dera Ghazi Khan', 'Muzaffargarh', 'Rahim Yar Khan',
      'Sheikhupura', 'Kasur', 'Mianwali', 'Toba Tek Singh', 'Chiniot', 'Vehari',
      'Okara', 'Jhang', 'Hafizabad', 'Khushab', 'Pakpattan', 'Mandi Bahauddin',
      'Gujrat', 'Narowal', 'Bhakkar', 'Layyah', 'Jhelum', 'Nankana Sahib',
      'Lodhran', 'Attock', 'Khanewal', 'Bahawalnagar', 'Rajanpur', 'Chakwal'
    ];

    for (const district of districts) {
      const data = await fetchSmogData(date, district);
      if (data) {
        // Update the popup for each district on the map
        // Assume you have a function to get the district layer and set popup content
        const popupContent = `
          <strong>District: ${district}</strong><br>
          Vehicle: ${data.Vehicle.toFixed(2)}<br>
          Industry: ${data.Industry.toFixed(2)}<br>
          Residential: ${data.Residential.toFixed(2)}<br>
          Miscellaneous: ${data.Misc.toFixed(2)}<br>
          Construction: ${data.Construction.toFixed(2)}<br>
          Agriculture: ${data.Agriculture.toFixed(2)}<br>
          Sum of Sources: ${data.Sum_of_Sources.toFixed(2)}<br>
          Vehicle %: ${data['Vehicle%'].toFixed(2)}%<br>
          Industry %: ${data['Industry%'].toFixed(2)}%<br>
        `;
        // Assume the function setDistrictPopup exists
        setDistrictPopup(district, popupContent);
      }
    }
  }

  // Dummy function to simulate setting the popup for a district
  function setDistrictPopup(district, content) {
    // Implement the actual logic to find the district layer and set its popup
    console.log(`Setting popup for ${district} with content:`, content);
  }
</script>

<script>
  // Function to fetch smog data based on selected date and district
  async function fetchSmogData(date, district) {
    // Format the date as MM/DD/YYYY
    const formattedDate = new Date(date).toLocaleDateString('en-US');
    try {
      const response = await fetch(`https://smog-server.onrender.com/api/october_sources?input_date=${encodeURIComponent(formattedDate)}&input_district=${encodeURIComponent(district)}`);
      if (!response.ok) throw new Error('Network response was not ok');
      const data = await response.json();
      return data;
    } catch (error) {
      console.error(`Failed to fetch data for ${district}:`, error);
      return null;
    }
  }

  // Event listener for date picker change
  document.getElementById('date-picker').addEventListener('change', function() {
    const selectedDate = this.value;
    if (selectedDate) {
      // Update popups for each district based on the selected date
      updateDistrictPopups(selectedDate);
    }
  });

  // Function to update popups with smog data
  async function updateDistrictPopups(date) {
    // Example districts - you should replace this with actual district data used in the map
    const districts = [
      'Lahore', 'Faisalabad', 'Rawalpindi', 'Multan', 'Gujranwala', 'Sialkot',
      'Sargodha', 'Bahawalpur', 'Dera Ghazi Khan', 'Muzaffargarh', 'Rahim Yar Khan',
      'Sheikhupura', 'Kasur', 'Mianwali', 'Toba Tek Singh', 'Chiniot', 'Vehari',
      'Okara', 'Jhang', 'Hafizabad', 'Khushab', 'Pakpattan', 'Mandi Bahauddin',
      'Gujrat', 'Narowal', 'Bhakkar', 'Layyah', 'Jhelum', 'Nankana Sahib',
      'Lodhran', 'Attock', 'Khanewal', 'Bahawalnagar', 'Rajanpur', 'Chakwal'
    ];

    for (const district of districts) {
      const data = await fetchSmogData(date, district);
      if (data) {
        // Update the popup for each district on the map
        // Assume you have a function to get the district layer and set popup content
        const popupContent = `
          <strong>District: ${district}</strong><br>
          Vehicle: ${data.Vehicle.toFixed(2)}<br>
          Industry: ${data.Industry.toFixed(2)}<br>
          Residential: ${data.Residential.toFixed(2)}<br>
          Miscellaneous: ${data.Misc.toFixed(2)}<br>
          Construction: ${data.Construction.toFixed(2)}<br>
          Agriculture: ${data.Agriculture.toFixed(2)}<br>
          Sum of Sources: ${data.Sum_of_Sources.toFixed(2)}<br>
          Vehicle %: ${data['Vehicle%'].toFixed(2)}%<br>
          Industry %: ${data['Industry%'].toFixed(2)}%<br>
        `;
        // Assume the function setDistrictPopup exists
        setDistrictPopup(district, popupContent);
      }
    }
  }

  // Dummy function to simulate setting the popup for a district
  function setDistrictPopup(district, content) {
    // Implement the actual logic to find the district layer and set its popup
    console.log(`Setting popup for ${district} with content:`, content);
  }
</script>
</body>
</html>
