<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>AQI Punjab Dashboard</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css" />
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.css" />
  <link rel="stylesheet" href="dist/css/skins/_all-skins.css" />
  <!-- Morris chart -->
  <link rel="stylesheet" href="bower_components/morris.js/morris.css" />
  <!-- jvectormap -->
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css" />
  <!-- Date Picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" />
  <!-- Daterange picker -->
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css" />
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" />
  <link rel="stylesheet" href="./dist/css/style.css" />
  <!-- Leaflet Libs -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <!-- ShapeFile Lib -->
  <script src="https://unpkg.com/shapefile@0.6.6/dist/shapefile.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic" />
</head>
<body class="hold-transition skin-blue sidebar-mini">
  <div class="wrapper">
    <header class="main-header">
      <!-- Header Navbar: style can be found in header.less -->
      <nav class="navbar navbar-static-top">
        <!-- Logo -->
        <a href="#" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels -->
          <span class="logo-mini"><b>A</b>LT</span>
          <!-- logo for regular state and mobile devices -->
          <img src="dist/img/logo.png" class="logo-image w-[100px] h-[80px] rounded-full" />
          <p class="uppercase">
            Punjab Information
            <br />
            Technology Board
            <br />
            <span>GOVERNMENT OF THE PUNJAB</span>
          </p>
        </a>
      </nav>
    </header>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header heading-bg pt-8">
        <div class="flex flex-col items-start lg:flex-row lg:items-end gap-8 justify-between relative">
          <div>
            <img src="dist/img/banner-icon.svg" alt="User Image" />
            <div class="flex items-center gap-4">
              <p class="text-4xl lg:text-6xl font-bold">AQI in</p>
              <p class="text-4xl lg:text-6xl font-bold">
                <select id="header-district-selector" class="w-fit bg-transparent border-2 border-red-500 z-[1000] cursor-pointer"></select>
              </p>
              <p class="hidden text-4xl lg:text-6xl font-bold">Pakistan</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Main content -->
      <div class="container mt-5">
        <h1 class="text-center">Smog Data for Punjab Districts</h1>

        <!-- Date Picker -->
        <div class="form-group text-center mt-4">
          <label for="date-picker" class="h4">Select Date:</label>
          <input type="date" id="date-picker" class="form-control w-25 mx-auto" />
        </div>

        <!-- Table to display data -->
        <table class="table table-bordered mt-4">
          <thead class="thead-dark">
            <tr>
              <th>District</th>
              <th>Vehicle</th>
              <th>Industry</th>
              <th>Residential</th>
              <th>Miscellaneous</th>
              <th>Construction</th>
              <th>Agriculture</th>
              <th>Sum of Sources</th>
              <th>Vehicle %</th>
              <th>Industry %</th>
              <th>Residential %</th>
              <th>Miscellaneous %</th>
              <th>Construction %</th>
              <th>Agriculture %</th>
            </tr>
          </thead>
          <tbody id="district-data-table">
            <!-- Data rows will be dynamically inserted here -->
          </tbody>
        </table>
      </div>
    </div>
    <!-- /.content-wrapper -->

    <!-- jQuery 3 -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- Custom Script for fetching data -->
    <script>
      // All 36 districts of Punjab
      const districts = [
        'Lahore', 'Faisalabad', 'Rawalpindi', 'Multan', 'Gujranwala', 'Sialkot',
        'Sargodha', 'Bahawalpur', 'Dera Ghazi Khan', 'Muzaffargarh', 'Rahim Yar Khan',
        'Sheikhupura', 'Kasur', 'Mianwali', 'Toba Tek Singh', 'Chiniot', 'Vehari',
        'Okara', 'Jhang', 'Hafizabad', 'Khushab', 'Pakpattan', 'Mandi Bahauddin',
        'Gujrat', 'Narowal', 'Bhakkar', 'Layyah', 'Jhelum', 'Nankana Sahib',
        'Lodhran', 'Attock', 'Khanewal', 'Bahawalnagar', 'Rajanpur', 'Chakwal'
      ];

      // Function to fetch data based on selected date
      async function fetchDistrictData(date) {
        const tableBody = document.getElementById('district-data-table');
        tableBody.innerHTML = ''; // Clear existing table data

        // Format the date as MM/DD/YYYY
        const formattedDate = new Date(date).toLocaleDateString('en-US');

        for (const district of districts) {
          try {
            const response = await fetch(`https://smog-server.onrender.com/api/october_sources?input_date=${encodeURIComponent(formattedDate)}&input_district=${encodeURIComponent(district)}`);
            if (!response.ok) throw new Error('Network response was not ok');
            const data = await response.json();

            // Create a new row for the table
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${district}</td>
              <td>${data.Vehicle.toFixed(2)}</td>
              <td>${data.Industry.toFixed(2)}</td>
              <td>${data.Residential.toFixed(2)}</td>
              <td>${data.Misc.toFixed(2)}</td>
              <td>${data.Construction.toFixed(2)}</td>
              <td>${data.Agriculture.toFixed(2)}</td>
              <td>${data.Sum_of_Sources.toFixed(2)}</td>
              <td>${data['Vehicle%'].toFixed(2)}%</td>
              <td>${data['Industry%'].toFixed(2)}%</td>
              <td>${data['Residential%'].toFixed(2)}%</td>
              <td>${data['Misc%'].toFixed(2)}%</td>
              <td>${data['Construction%'].toFixed(2)}%</td>
              <td>${data['Agriculture%'].toFixed(2)}%</td>
            `;
            tableBody.appendChild(row);
          } catch (error) {
            console.error(`Failed to fetch data for ${district}:`, error);
          }
        }
      }

      // Event listener for date picker change
      document.getElementById('date-picker').addEventListener('change', function() {
        const selectedDate = this.value;
        if (selectedDate) {
          fetchDistrictData(selectedDate);
        }
      });
    </script>
  </body>
</html>
