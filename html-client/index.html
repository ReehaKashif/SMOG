<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smog Data for Punjab Districts</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center">Smog Data for Punjab Districts</h1>
    
    <!-- Date Picker -->
    <div class="form-group text-center mt-4">
      <label for="date-picker" class="h4">Select Date:</label>
      <input type="date" id="date-picker" class="form-control w-25 mx-auto" />
    </div>

    <!-- Table to display data -->
    <table class="table table-bordered mt-4">
      <thead class="thead-dark">
        <tr>
          <th>District</th>
          <th>Vehicle</th>
          <th>Industry</th>
          <th>Residential</th>
          <th>Miscellaneous</th>
          <th>Construction</th>
          <th>Agriculture</th>
          <th>Sum of Sources</th>
          <th>Vehicle %</th>
          <th>Industry %</th>
          <th>Residential %</th>
          <th>Miscellaneous %</th>
          <th>Construction %</th>
          <th>Agriculture %</th>
        </tr>
      </thead>
      <tbody id="district-data-table">
        <!-- Data rows will be dynamically inserted here -->
      </tbody>
    </table>
  </div>

  <script>
    // All 36 districts of Punjab
    const districts = [
      'Lahore', 'Faisalabad', 'Rawalpindi', 'Multan', 'Gujranwala', 'Sialkot',
      'Sargodha', 'Bahawalpur', 'Dera Ghazi Khan', 'Muzaffargarh', 'Rahim Yar Khan',
      'Sheikhupura', 'Kasur', 'Mianwali', 'Toba Tek Singh', 'Chiniot', 'Vehari',
      'Okara', 'Jhang', 'Hafizabad', 'Khushab', 'Pakpattan', 'Mandi Bahauddin',
      'Gujrat', 'Narowal', 'Bhakkar', 'Layyah', 'Jhelum', 'Nankana Sahib',
      'Lodhran', 'Attock', 'Khanewal', 'Bahawalnagar', 'Rajanpur', 'Chakwal'
    ];

    // Function to fetch data based on selected date
    async function fetchDistrictData(date) {
      const tableBody = document.getElementById('district-data-table');
      tableBody.innerHTML = ''; // Clear existing table data

      // Format the date as MM/DD/YYYY
      const formattedDate = new Date(date).toLocaleDateString('en-US');

      for (const district of districts) {
        try {
          const response = await fetch(`https://smog-server.onrender.com/api/october_sources?input_date=${encodeURIComponent(formattedDate)}&input_district=${encodeURIComponent(district)}`);
          if (!response.ok) throw new Error('Network response was not ok');
          const data = await response.json();
          
          // Create a new row for the table
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${district}</td>
            <td>${data.Vehicle.toFixed(2)}</td>
            <td>${data.Industry.toFixed(2)}</td>
            <td>${data.Residential.toFixed(2)}</td>
            <td>${data.Misc.toFixed(2)}</td>
            <td>${data.Construction.toFixed(2)}</td>
            <td>${data.Agriculture.toFixed(2)}</td>
            <td>${data.Sum_of_Sources.toFixed(2)}</td>
            <td>${data['Vehicle%'].toFixed(2)}%</td>
            <td>${data['Industry%'].toFixed(2)}%</td>
            <td>${data['Residential%'].toFixed(2)}%</td>
            <td>${data['Misc%'].toFixed(2)}%</td>
            <td>${data['Construction%'].toFixed(2)}%</td>
            <td>${data['Agriculture%'].toFixed(2)}%</td>
          `;
          tableBody.appendChild(row);
        } catch (error) {
          console.error(`Failed to fetch data for ${district}:`, error);
        }
      }
    }

    // Event listener for date picker change
    document.getElementById('date-picker').addEventListener('change', function() {
      const selectedDate = this.value;
      if (selectedDate) {
        fetchDistrictData(selectedDate);
      }
    });
  </script>
</body>
</html>
