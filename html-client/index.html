<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>AQI Punjab Dashboard</title>
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css" />
  <link rel="stylesheet" href="dist/css/AdminLTE.css" />
  <link rel="stylesheet" href="dist/css/skins/_all-skins.css" />
  <link rel="stylesheet" href="bower_components/jvectormap/jquery-jvectormap.css" />
  <link rel="stylesheet" href="bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" />
  <link rel="stylesheet" href="bower_components/bootstrap-daterangepicker/daterangepicker.css" />
  <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" />
  <link rel="stylesheet" href="./dist/css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Include leaflet.shapefile for loading shapefiles -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shapefile/0.6.11/shapefile.min.js"></script>
</head>
<body class="hold-transition skin-blue sidebar-mini">
  <div class="wrapper">
    <header class="main-header">
      <nav class="navbar navbar-static-top">
        <a href="#" class="logo">
          <span class="logo-mini"><b>A</b>LT</span>
          <img src="dist/img/logo.png" class="logo-image w-[100px] h-[80px] rounded-full" />
          <p class="uppercase">
            Punjab Information
            <br />
            Technology Board
            <br />
            <span>GOVERNMENT OF THE PUNJAB</span>
          </p>
        </a>
      </nav>
    </header>

    <div class="content-wrapper">
      <!-- Date Picker for selecting the date -->
      <div class="container mt-5">
        <div class="form-group text-center">
          <label for="date-picker" class="h4">Select Date:</label>
          <input type="date" id="date-picker" class="form-control w-25 mx-auto" />
        </div>
      </div>

      <!-- Main content - Map -->
      <div class="container mt-4">
        <div id="forecastMap" style="height: 750px;"></div>
      </div>
    </div>

    <!-- jQuery 3 -->
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Include your map.js functionality here -->
    <script src="dist/js/lib/map.js"></script>

    <script>
      // Initialize the map
      const map = L.map('forecastMap').setView([31.5, 73.0], 7);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data Â© OpenStreetMap contributors'
      }).addTo(map);

      // Function to load and display district boundaries
      async function loadDistrictBoundaries() {
        const districts = [
          'Lahore', 'Faisalabad', 'Rawalpindi', 'Multan', 'Gujranwala',
          'Sialkot', 'Sargodha', 'Bahawalpur', 'Dera Ghazi Khan', 'Muzaffargarh',
          'Rahim Yar Khan', 'Sheikhupura', 'Kasur', 'Mianwali', 'Toba Tek Singh',
          'Chiniot', 'Vehari', 'Okara', 'Jhang', 'Hafizabad',
          'Khushab', 'Pakpattan', 'Mandi Bahauddin', 'Gujrat', 'Narowal',
          'Bhakkar', 'Layyah', 'Jhelum', 'Nankana Sahib', 'Lodhran',
          'Attock', 'Khanewal', 'Bahawalnagar', 'Rajanpur', 'Chakwal'
        ];

        // Loop through each district and load its shapefile
        for (const district of districts) {
          const formattedDistrict = district.replace(/\s+/g, "_");
          const shapefilePath = `html-client/shapefiles/${formattedDistrict}.shp`;

          try {
            const response = await fetch(shapefilePath);
            const arrayBuffer = await response.arrayBuffer();

            // Use leaflet.shapefile to add the shapefile layer with black boundaries
            const shapefileLayer = L.shapefile(arrayBuffer, {
              style: {
                color: "black", // Black boundaries
                weight: 2
              },
              onEachFeature: function (feature, layer) {
                if (feature.properties) {
                  // Bind a popup with feature properties
                  layer.bindPopup(Object.keys(feature.properties).map(function (k) {
                    return k + ": " + feature.properties[k];
                  }).join("<br />"), { maxHeight: 200 });
                }
              }
            });

            shapefileLayer.addTo(map);
          } catch (error) {
            console.error(`Error loading shapefile for ${district}:`, error);
          }
        }
      }

      // Call the function to load district boundaries
      loadDistrictBoundaries();

      // Event listener for date picker change
      document.getElementById('date-picker').addEventListener('change', function () {
        const selectedDate = this.value;
        if (selectedDate) {
          // You can add additional functionality here for the date change event
          console.log(`Date selected: ${selectedDate}`);
        }
      });
    </script>
  </body>
</html>
